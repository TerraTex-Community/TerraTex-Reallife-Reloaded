--
-- Created by IntelliJ IDEA.
-- User: accow
-- Date: 12.02.14
-- Time: 16:31
-- To change this template use File | Settings | File Templates.
--

-- haltestellenTabelle: Aufbau: [id]={x,y,z,richtung,name}
haltestellenTable={}
haltestellenTable[1]={1247.08203125,-1854.8349609375,12.976508140564,"O","Busbahnhof Los Santos"}
haltestellenTable[2]={1480.5068359375,-1734.84765625,12.977502822876,"O","Stadthalle Los Santos"}
haltestellenTable[3]={1727.4296875,-1817.3427734375,12.956211090088,"O","Hauptbahnhof Los Santos"}
haltestellenTable[4]={1975.740234375,-2169.294921875,12.976576805115,"O","Los Santos Airport"}
haltestellenTable[5]={2764.7294921875,-2476.080078125,13.079533576965,"N","Industriehafen"}
haltestellenTable[6]={2217.1875,-1959.6083984375,12.946669578552,"N","Muelldeponie"}
haltestellenTable[7]={2345.123046875,-1710.5380859375,12.948126792908,"N","Grove Street"}
haltestellenTable[8]={2178.435546875,-1103.5263671875,24.759315490723,"W","Am Billigautohaendler"}
haltestellenTable[9]={1345.3310546875,-1087.7548828125,23.867015838623,"S","Bank- und Versicherungszentrale"}
haltestellenTable[10]={1206.8095703125,-932.9482421875,42.309909820557,"W","Burgershot Nord"}
haltestellenTable[11]={429.8974609375,-1322.6494140625,14.470834732056,"W","Am Motorradautohaus"}
haltestellenTable[12]={397.1748046875,-1719.373046875,7.8105020523071,"O","Santa Maria Beach"}
haltestellenTable[13]={853.6962890625,-1601.1865234375,12.984456062317,"NO","Burgershot Sued"}
haltestellenTable[14]={1147.1943359375,-1652.330078125,13.375065803528,"S","Paper Cut"}
haltestellenTable[15]={2074.490234375,1004.9736328125,10.26812171936,"N","Four Dragons"}
haltestellenTable[16]={2074.560546875,1609.2138671875,10.27165222168,"N","Caligulas Casino"}
haltestellenTable[17]={2333.974609375,2410.4189453125,10.262638092041,"O","Las Venturas Police Department"}
haltestellenTable[18]={2788.9736328125,2323.7822265625,10.330431938171,"N","Einkaufszentrum Las Venturas"}
haltestellenTable[19]={2321.3017578125,2415.849609375,10.268193244934,"W","Las Venturas Police Department"}
haltestellenTable[20]={2119.3505859375,2195.232421875,10.267531394958,"S","Las Venturas Center"}
haltestellenTable[21]={1872.6943359375,2051.5498046875,10.274922370911,"W","Burgershot Las Venturas"}
haltestellenTable[22]={1729.1416015625,1531.267578125,10.268995285034,"S","Las Venturas Airport"}
haltestellenTable[23]={1564.7939453125,1022.2822265625,10.308483123779,"S","Big Bananas"}
haltestellenTable[24]={1564.3427734375,713.697265625,10.34113407135,"S","Stadtreinigung"}
haltestellenTable[25]={1489.4443359375,709.828125,10.27712059021,"W","Las Venturas Kappelle"}
haltestellenTable[26]={1569.9873046875,738.392578125,10.267623901367,"N","Stadtreinigung"}
haltestellenTable[27]={1726.775390625,1481.1240234375,10.272372245789,"N","Las venturas Airport"}
haltestellenTable[28]={1820.900390625,-2058.154296875,12.983082771301,"S","Taxidepot"}
haltestellenTable[29]={2075.23828125,1488.0751953125,10.268018722534,"N","The High Roller"}
haltestellenTable[30]={2844.82421875,2228.8671875,10.269249916077,"S","Wohnpark Ost"}
haltestellenTable[31]={2581.951171875,2115.3818359375,10.272778511047,"W","Ammonation"}
haltestellenTable[32]={1705.3388671875,1966.6904296875,10.261113166809,"S","Shody Used Autos"}
haltestellenTable[33]={1606.3349609375,1875.7724609375,10.272841453552,"W","Medizinische Klinik Las Venturas"}
haltestellenTable[34]={1085.3125,1190.890625,10.265817642212,"O","San Andreas News"}
haltestellenTable[35]={1603.8720703125,1130.2822265625,10.273937225342,"O","Big Bananas"}
haltestellenTable[36]={682.908203125,-1408.33984375,13.001130104065,"O","San Andreas Television"}
haltestellenTable[37]={1824.328125,-1702.75390625,12.976136207581,"N","Alhambra"}
haltestellenTable[38]={1611.0634765625,-1323.6669921875,16.899394989014,"N","Startower"}
haltestellenTable[39]={1972.5546875,-1197.408203125,25.247852325439,"N","Glenpark"}
haltestellenTable[40]={2497.5361328125,-1259.30859375,33.383598327637,"O","Am Loch"}
haltestellenTable[41]={2662.9521484375,-1654.6923828125,10.30385684967,"W","Los Santos Arena"}
haltestellenTable[42]={2551.140625,44.638671875,25.940244674683,"W","Palomi no Creek"}
haltestellenTable[43]={1925.09765625,2315.935546875,10.272721290588,"S","Souvenirs"}
haltestellenTable[44]={1502.4853515625,2055.51171875,10.271769523621,"W","Baseballstadion"}
haltestellenTable[45]={1122.2490234375,1810.701171875,10.398947715759,"O","Die Arena"}
haltestellenTable[46]={-431.1923828125,1421.1240234375,32.377479553223,"N","Big Ear"}
haltestellenTable[47]={-887.865234375,1981.9775390625,60.390651702881,"S","Am Staudamm"}
haltestellenTable[48]={-2693.599609375,1765.3564453125,67.697875976563,"S","Golden Gatebridge"}
haltestellenTable[49]={-1964.345703125,1119.72265625,53.020462036133,"N","Kathedrale"}
haltestellenTable[50]={-2096.3994140625,-288.8720703125,35.023609161377,"W","San Fierro Arena"}
haltestellenTable[51]={-2729.1953125,-309.171875,6.6360359191895,"SW","Tennisplatz"}
haltestellenTable[52]={-2413.7451171875,-624.6025390625,132.05143737793,"S","Elektrizitaetswerk"}
haltestellenTable[53]={-2245.009765625,-2194.4228515625,35.412910461426,"NW","Mount Chilliad"}
haltestellenTable[54]={960.00390625,-1118.8642578125,23.27748298645,"S","Am Friedhof"}
haltestellenTable[55]={940.0146484375,-1239.89453125,15.92155456543,"S","Am Filmstudio"}
haltestellenTable[56]={2306.166015625,-2325.791015625,12.978335380554,"SW","Meeresreinigerstation"}
haltestellenTable[57]={2083.8828125,-1845.712890625,12.985579490662,"N","Well Stacked Pizza"}
haltestellenTable[58]={2402.849609375,-1258.8046875,23.430063247681,"O","PigPen"}
haltestellenTable[59]={1083.6396484375,1195.91796875,10.279914855957,"W","San Andreas News"}
haltestellenTable[60]={-124.072265625,-401.91796875,0.6882746219635,"SO","Fleischberg"}
haltestellenTable[61]={-1042.74609375,-1185.97265625,128.49440002441,"N","Hauptfarm"}

routenListe={}
routenListe["fraktion"]={1,2,3,28,7,8,29,16,17,30,31,21,32,33,34,35,27,10,36,13,14}
routenListe["sehenswert"]={1,2,3,37,38,39,40,41,42,15,16,43,44,45,46,47,48,49,50,51,52,53,54,55,14}
routenListe["all"]={1,2,3,4,5,6,7,8,15,16,17,18,19,20,21,22,23,24,25,26,27,9,10,11,12,13,14}
routenListe["job"]={1,2,3,4,56,5,6,57,58,8,22,23,25,26,59,60,61,12}
routenListe["rookie"]={1,2,3,4,5,6,7,8,9,10,11,12,13,14 }

--[[Abfrage Befehle für die Haltestellen]]
function getHaltestellenKoordinaten(hID)
    return haltestellenTable[hID][1],haltestellenTable[hID][2],haltestellenTable[hID][3]
end

function getHaltestellenKoordinatenByRouteID(route, ID)
    local hID=routenListe[route][ID]
    return haltestellenTable[hID][1],haltestellenTable[hID][2],haltestellenTable[hID][3]
end

function getNextRouteHaltestellenIndex(route, aktuellerIndex)
    local newIndex=aktuellerIndex+1
    if(aktuellerIndex>=table.getSize(routenListe[route]))then
        newIndex=1
    end
    return newIndex
end

function getHaltestellenNameByRoute(route,ID)
    local HID=routenListe[route][ID]
    return haltestellenTable[HID][5]
end

function getHaltestellenName(ID)
    return haltestellenTable[ID][5]
end

--local CreateInfoIcons

local dieAnderenHCoords={
    { 1084.51171875,1199.9189453125,10.8203125,4.4962158203125 },-- newsicon
    { 1603.4931640625,1124.6435546875,10.8203125,177.70379638672 },-- iconbigbananas
    { 1722.87109375,1529.185546875,10.8203125,100.73245239258 },-- LVairport S
    { 1732.7509765625,1479.82421875,10.8203125,263.71160888672 },-- LV Airport N
    { 1698.5712890625,1964.833984375,10.8203125,76.144653320313 },-- Shody Used Cars
    { 1501.658203125,2061.732421875,10.8203125,2.5735778808594 },-- baseballstadion
    { 1918.7900390625,2314.1865234375,10.8203125,92.289337158203 },-- souvenirs
    { 2580.53515625,2121.958984375,10.8203125,4.3204345703125 },-- Ammonation
}
local allHIcons={}


function loadHInfoIcons()
    local haltestellenObjecte=getElementsByType("object")
    for theKey, theObject in ipairs(haltestellenObjecte)do
        if(getElementModel(theObject)==1257)then
            local x,y,z=getElementPosition(theObject)
            local pickup=createPickup( x,y,z, 3, 1239, 1000)
            vioSetElementData(pickup,"haltestellenID",false)
            table.insert(allHIcons,pickup)
        end
    end
    -- Die anderen Icons Hinzufügen
    for theKey, theCoords in ipairs(dieAnderenHCoords)do
        local pickup=createPickup( theCoords[1],theCoords[2],theCoords[3], 3, 1239, 1000)
        vioSetElementData(pickup,"haltestellenID",false)
        table.insert(allHIcons,pickup)
    end
    -- Welche icons sind zu weit weg / irrelevant / gehören zu welcher Haltestelle?
    for theKey, theHaltestelle in ipairs(haltestellenTable)do
        local nearestIcon=false
        local nearestEntf=30
        for theIconKey, theIcon in ipairs(allHIcons)do
            local x,y,z=getElementPosition(theIcon)
            local iconDist=getDistanceBetweenPoints3D(x,y,z,theHaltestelle[1],theHaltestelle[2],theHaltestelle[3])
            if(iconDist<nearestEntf)then
                nearestEntf=iconDist
                nearestIcon=theIcon
            end
        end
        if not nearestIcon then
           outputDebugString("error: "..theKey)
        end
        vioSetElementData(nearestIcon,"haltestellenID",theKey)
    end
    --
    for thekey, thePickup in ipairs(allHIcons)do
        if(not vioGetElementData(thePickup,"haltestellenID"))then
            destroyElement(thePickup)
        else
            addEventHandler( "onPickupHit", thePickup, showHInfo )
        end
    end
end
addEventHandler("onResourceStart",getResourceRootElement(getThisResource()),loadHInfoIcons)

function showHInfo(thePlayer)
    local hID=vioGetElementData(source,"haltestellenID")
    local linienhit={}
    for theKey, theLinie in pairs(routenListe)do
        for theHKey,theHID in ipairs(theLinie)do
            if(theHID==hID)then
                table.insert(linienhit,theKey)
            end
        end
    end
    local busListe={}
    --vioSetElementData(busveh,"isBusVeh",true)
    for theKey, theVehicle in ipairs(getElementsByType('vehicle')) do
        if(vioGetElementData(theVehicle,"isBusVeh"))then
            table.insert(busListe,theVehicle)
        end
    end
    triggerClientEvent(thePlayer,"showFahrplan",thePlayer,hID,linienhit,busListe )
end

addEvent("giveMeHList",true)
function giveMeHList_func()
    triggerClientEvent(source,"sendHData",source,routenListe, haltestellenTable)
end
addEventHandler("giveMeHList",getRootElement(),giveMeHList_func)








